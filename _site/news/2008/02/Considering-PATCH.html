<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Considering PATCH</title>
  <meta name="description" content="Dare Obasanjo: Given that Joe works for Google on GData, I have assumed that Joe&#39;s post is Google&#39;s attempt to float a trial balloon before extending AtomPub...">
  <meta name="google-site-verification" content="vZSL2JjLp0S_VXH743XRWWgko2D6B124A8pUAqT4FFk" />

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://bitworking.org/news/2008/02/Considering-PATCH">
  <link rel="alternate" type="application/atom+xml" title="BitWorking" href="/news/feed/">
  <link rel="author" href="/about/">
  <link href="https://webmention.bitworking.org/IncomingWebMention" rel="webmention" />
  <script async defer src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML'></script>
  <meta name="twitter:site"    content="@bitworking">
  <meta name="twitter:creator" content="@bitworking">
  <meta name="twitter:title"   content="Considering PATCH">
  <meta name="twitter:description" content="  Dare Obasanjo:  Given that Joe works for Google on GData, I have assumed that Joe's post is Google's attempt to float a trial balloon before extending AtomPub in this way. As I explained in the comments on Dare's post, this is my personal blog and unless otherwise stated, my own thoughts and ideas. If I weren't just speaking for myself I would make that clear. Like I am about to do now. At Google we are considering using PATCH. One of the big open questions surrounding that decision is XML patch formats. What have you found for patch formats and associated libraries?
  
    Unfortunately not much that's usable.  All of the xml-diff approaches that have been floated over the years tend towards being grossly overcomplicated.
    Posted by
       James Snell on 2008-02-20
    

    Is XUpdate a viable option?
    Posted by
       Stephen Bounds on 2008-02-20
    

    There's an IETF draft out for something that fails one of James' tests (it's in XML), but seems to have some thought put into the structure and operations you'd need:

">
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content="https://bitworking.org/images/newlogo.png">
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">
      <img src="https://bitworking.org/images/newlogo.png" >
      BitWorking
    </a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Considering PATCH</h1>
    <p class="post-meta">
      <a class="u-url" href="/news/2008/02/Considering-PATCH">
        <time datetime="2008-02-20T00:00:00-05:00" itemprop="datePublished" class="dt-published">
          
          Feb 20, 2008
        </time>
      </a>
      • <a rel="author me" class="p-author h-card" href="/about"> <span itemprop="author"
          itemscope itemtype="http://schema.org/Person">
          <img class="u-photo" src="/images/joe2016.jpg" alt="" style="height: 16px; border-radius: 8px; margin-right: 4px;" />
          <span
            itemprop="name">Joe Gregorio</span></span></a>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
      <p><a href="http://www.25hoursaday.com/weblog/2008/02/16/ThoughtsOnGooglesProposalForGranularUpdatesInAtomPub.aspx">Dare Obasanjo</a>:</p> <blockquote> <p>Given that Joe works for Google on GData, I have assumed that Joe's post is Google's attempt to float a trial balloon before extending AtomPub in this way.</p></blockquote> <p>As I explained in the comments on Dare's post, this is my personal blog and unless otherwise stated, my own thoughts and ideas. If I weren't just speaking for myself I would make that clear.</p> <p>Like I am about to do now.</p> <p>At Google we are considering using PATCH. One of the big open questions surrounding that decision is XML patch formats. What have you found for patch formats and associated libraries?</p>
  <div class="commentContent" id="X1">
    Unfortunately not much that's usable.  All of the xml-diff approaches that have been floated over the years tend towards being grossly overcomplicated.
    <p class="commentByLine">Posted by
       <a href="mailto:jasnell@gmail.com">James Snell</a> on <a href="#X1" title="2008-02-20T13:09:18.689723">2008-02-20</a>
    </p>
</div><div class="commentContent" id="X2">
    Is <a href="http://www.xmldatabases.org/projects/XUpdate-UseCases/">XUpdate</a> a viable option?
    <p class="commentByLine">Posted by
       <a href="http://guruj.net">Stephen Bounds</a> on <a href="#X2" title="2008-02-20T20:01:08.961121">2008-02-20</a>
    </p>
</div><div class="commentContent" id="X3">
    There's an IETF draft out for something that fails one of James' tests (it's in XML), but seems to have some thought put into the structure and operations you'd need:

http://www.ietf.org/internet-drafts/draft-ietf-simple-xml-patch-ops-04.txt
    <p class="commentByLine">Posted by
       <a href="http://www.eighty-twenty.net">Gordon Weakliem</a> on <a href="#X3" title="2008-02-21T01:07:10.449554">2008-02-21</a>
    </p>
</div><div class="commentContent" id="X4">
    I am probably giving away my nievity here, but why not use a standard binary diff algorithm and use it equally for all media types?
    <p class="commentByLine">Posted by
       <a href="http://bytesexual.org/">Noah Slater</a> on <a href="#X4" title="2008-02-21T01:54:56.784182">2008-02-21</a>
    </p>
</div><div class="commentContent" id="X5">
    Binary diff for XML? Do I here canonicalization :)
    <p class="commentByLine">Posted by
       <a href="http://subbu.org">Subbu Allamaraju</a> on <a href="#X5" title="2008-02-21T08:40:36.518014">2008-02-21</a>
    </p>
</div><div class="commentContent" id="X6">
    Gordon,<br />
<p>
Yeah, that one, like all the ones I've found so far, tries to take on too much, such as manipulating namespace declarations, comments and processing instructions. In addition it doesn't present on algorithm on how to generate a patch from two documents, only a format for communicating the differences.
</p>
<p>
A good candidate would have a limited number of operations, and not only specify  the patch format and how to apply it, but how to generate a patch document from a pair of documents. For example: flatten the DOM into a sequence of SAX-like events and then applying a line oriented diff to the two sequences. The operations should be very limited in scope: delete element, add element, edit text node, edit element attributes. It could be that simple if I don't care about multi-master synchronization or three-way merge.
</p>

Noah,<br />
<p>
A binary diff presumes that two actors would serialize the same XML DOM in the same exact way, which as Subbu points out is the realm of XML canonicalization, and not anywhere you want to go.
</p>

    <p class="commentByLine">Posted by
       <a href="http://bitworking.org">Joe</a> on <a href="#X6" title="2008-02-21T10:56:50.930259">2008-02-21</a>
    </p>
</div><div class="commentContent" id="X7">
    <p>Joe: "<i>A good candidate would have a limited number of operations, and not only specify the patch format and how to apply it, but how to generate a patch document from a pair of documents. For example: flatten the DOM into a sequence of SAX-like events and then applying a line oriented diff to the two sequences. The operations should be very limited in scope: delete element, add element, edit text node, edit element attributes. It could be that simple if I don't care about multi-master synchronization or three-way merge.</i>"</p>
<p>This is a big part of where I was going with <a href="http://www.snellspace.com/wp/?p=895">this</a>.  For the most part, existing solutions try to do way too much.</p>
    <p class="commentByLine">Posted by
       <a href="mailto:jasnell@gmail.com">James Snell</a> on <a href="#X7" title="2008-02-21T14:32:42.704226">2008-02-21</a>
    </p>
</div><div class="commentContent" id="X8">
    Joe, as far as an algorithm, the standard for tree differences is the Zhang-Shasha  algorithm.  The Microsoft XML Diff toolkit implements that along with another "fast" algorithm, which is unpublished to my knowlege.  That said, that's an implementation that solves the entire issue.  Also, XML isn't strictly a tree (because of attribute axes), so there's that issue.  Anyway, <a href="http://useless-factor.blogspot.com/2008/01/matching-diffing-and-merging-xml.html">this blog post</a> has a pretty good discussion of Zhang-Shasha.

I'd <a href="http://www.eighty-twenty.net/blog/2006/02/22.html#11675">blogged on that</a> a couple years ago when I was trying to deal with merging OPML documents. 
In the end, I pretty much punted on solving my problem because for my particular case, it was gold plating a solution.
    <p class="commentByLine">Posted by
       <a href="http://www.eighty-twenty.net">Gordon Weakliem</a> on <a href="#X8" title="2008-02-21T14:59:22.657573">2008-02-21</a>
    </p>
</div><div class="commentContent" id="X9">
    <p>ISTR IBM had something in this space called TreeDiff...
</p><p>
(rummages about the internet)
</p><p>
Hmm, it looks like it's been 'retired':
</p><p>
<a href="http://www.alphaworks.ibm.com/tech/xmltreediff">http://www.alphaworks.ibm.com/tech/xmltreediff</a>
</p><p>
The Wayback Machine has a bit more from before the retirement in late 2003:
</p><p>
<a href="http://web.archive.org/web/20031002102746/http://alphaworks.ibm.com/tech/xmltreediff">http://web.archive.org/web/20031002102746/http://alphaworks.ibm.com/tech/xmltreediff</a>
</p><p>
I guess that's not actually very helpful, sorry.
</p>
    <p class="commentByLine">Posted by
       <a href="http://michaelbernstein.com">Michael R. Bernstein</a> on <a href="#X9" title="2008-02-22T16:04:02.212025">2008-02-22</a>
    </p>
</div><div class="commentContent" id="X10">
    Wouldn't XSLT be a viable option for "patching" an Atom entry? I realize it doesn't fit the traditional patch model, but since it is simple to copy everything and filter as needed, it seems like a simpler solution. For example, the PUT could contain an Atom entry with atom:link[rel='stylesheet'] where the server would take its copy and update it with the result. 

Just thinking aloud a bit.
    <p class="commentByLine">Posted by
       <a href="http://ionrock.org/blog/">Eric Larson</a> on <a href="#X10" title="2008-02-23T13:10:24.925749">2008-02-23</a>
    </p>
</div><div class="commentContent" id="X11">
    Yes, XSLT would work. However, XSLT is Turing-complete, and I’m not sure it’s a great idea to take code supplied by an arbitrary remote client and run it on the server. Although I guess as long as you impose the obvious limitations (disable the <code>document</code> function, limit the amount of memory and time a transform may hog, that sort of thing), that could work very well. But it does mean that the server has to lug an XSLT processor around, which is a much bigger component than, say, an XUpdate implementation. OTOH, unlike the XML patch formats, it has the upside that server and client need not agree exactly about the document’s Infoset: if elements change position or whitespace nodes shuffle around, the transform need not be affected at all.
    <p class="commentByLine">Posted by
       <a href="http://plasmasturm.org/">Aristotle Pagaltzis</a> on <a href="#X11" title="2008-02-23T19:56:35.351231">2008-02-23</a>
    </p>
</div>
  

    <a href="https://brid.gy/publish/twitter"></a>
  </div>

  <script type="text/javascript" charset="utf-8">
    fetch('https://webmention.bitworking.org/Mentions', {
      cache: 'no-cache',
    }).then(function(resp) {
      if (!resp.ok) {
        return
      }
      resp.text().then(function(text) {
        document.getElementById('mentions').innerHTML = text;
      });
    });
  </script>
  <div id=mentions>
  </div>

  
    <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://bitworking.org/news/2008/02/Considering-PATCH';
      this.page.identifier = 'https://bitworking.org/news/2008/02/Considering-PATCH';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://bitworking-1.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
  
</article>

      </div>
    </main><footer class="site-footer">

  <div class="wrapper">

    
    <div class="PageNavigation">
      
      <a class="prev" href="/news/2008/02/Anti-Social-Software">&laquo;
        Anti-Social Software</a>
      
      
      <a class="next"
        href="/news/2008/02/XML-2-0-I-make-it-fit">XML 2.0 - I make it fit! &raquo;</a>
      
    </div>
    

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              BitWorking
            
            </li>
            
            <li><a rel=me class="u-email" href="mailto:joe@bitworking.org">joe@bitworking.org</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jcgregorio" rel=me><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">jcgregorio</span></a>

          </li>
          

          <li>
            <a rel="me" href="https://mastodon.cc/@jcgregorio">
              <span class=icon>
                <svg xmlns="http://www.w3.org/2000/svg" height="16px" viewBox="0 0 216 232" width="16px" xml:space="preserve">
                  <path d="M211.80734 139.0875c-3.18125 16.36625-28.4925
                  34.2775-57.5625 37.74875-15.15875 1.80875-30.08375
                  3.47125-45.99875
                  2.74125-26.0275-1.1925-46.565-6.2125-46.565-6.2125 0
                  2.53375.15625 4.94625.46875 7.2025 3.38375 25.68625 25.47
                  27.225 46.39125 27.9425 21.11625.7225 39.91875-5.20625
                  39.91875-5.20625l.8675 19.09s-14.77 7.93125-41.08125
                  9.39c-14.50875.7975-32.52375-.365-53.50625-5.91875C9.23234
                  213.82 1.40609 165.31125.20859
                  116.09125c-.365-14.61375-.14-28.39375-.14-39.91875 0-50.33
                  32.97625-65.0825 32.97625-65.0825C49.67234 3.45375
                  78.20359.2425 107.86484 0h.72875c29.66125.2425 58.21125
                  3.45375 74.8375 11.09 0 0 32.975 14.7525 32.975 65.0825
                  0 0 .41375 37.13375-4.59875 62.915" fill="gray"/>
                  <path d="M177.50984 80.077v60.94125h-24.14375v-59.15c0-12.46875-5.24625-18.7975-15.74-18.7975-11.6025 0-17.4175 7.5075-17.4175 22.3525v32.37625H96.20734V85.42325c0-14.845-5.81625-22.3525-17.41875-22.3525-10.49375 0-15.74 6.32875-15.74 18.7975v59.15H38.90484V80.077c0-12.455 3.17125-22.3525 9.54125-29.675 6.56875-7.3225 15.17125-11.07625 25.85-11.07625 12.355 0 21.71125 4.74875 27.8975 14.2475l6.01375 10.08125 6.015-10.08125c6.185-9.49875 15.54125-14.2475 27.8975-14.2475 10.6775 0 19.28 3.75375 25.85 11.07625 6.36875 7.3225 9.54 17.22 9.54 29.675" fill="#fff"/>
                </svg>
              </span>
              <span class="username">jcgregorio</span></a>
            </a>
          </li>

          
          <li>
            <a href="https://twitter.com/bitworking" rel=me><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">bitworking</span></a>

          </li>
          

        </ul>
      </div>

      <div class="h-card footer-col footer-col-3">
        <p class="p-note">Joe Gregorio - REST, Web, Python, Go, APIs, Dad, Husband, Maker, or any linear combination of such. Googler.
</p>
        <a class="p-name u-url" href="https://bitworking.org" style="display: none"><img
          class="u-photo" src="/images/joe2016.jpg" alt="" />Joe Gregorio</a>
        <a rel=me class="u-email" href="mailto:joe@bitworking.org">joe@bitworking.org</a>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
