<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Flash Memory for the Blackfin DSP</title>
  <meta name="description" content="You&#39;ve seen all the warnings when upgrading the firmware on some card, be it your PCMCIA Wi-Fi card, or maybe your MP3 player. Interrupting a firmware update...">
  <meta name="google-site-verification" content="vZSL2JjLp0S_VXH743XRWWgko2D6B124A8pUAqT4FFk" />

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://bitworking.org/news/2004/04/Flash_Memory_for_the_Blackfin_DSP">
  <link rel="alternate" type="application/atom+xml" title="BitWorking" href="/news/feed/">
  <link rel="author" href="/about/">
  <link href="https://bitworking.org/u/webmention" rel="webmention" />
  <script async defer src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML'></script>
  <meta name="twitter:site"    content="@bitworking">
  <meta name="twitter:creator" content="@bitworking">
  <meta name="twitter:title"   content="Flash Memory for the Blackfin DSP">
  <meta name="twitter:description" content="  You've seen all the warnings when upgrading the firmware 
  on some card, be it your PCMCIA Wi-Fi card, or maybe your
  MP3 player.

Interrupting a firmware update in progress 
     (i.e. during the firmware upload into the SOMEHARDWARE) 
     may render the SOMEHARDWARE inoperative.
If the firmware upload fails, and subsequent 
     upload attempts prove unsuccessful, the unit may need 
     to be returned to THE COMPANY for service.

I've anonymized the above statement to save singling out a particular
   company, but I have seen this on a wide range of devices. So what's
   going on here, why are these devices so fragile?
Here's the basic layout of an embedded system, stripped to just
   the basics we want to talk about.

">
  <meta name="twitter:card"  content="summary">
  <meta name="twitter:image" content="https://bitworking.org/images/newlogo.png">

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1974123-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">
      <img src="https://bitworking.org/images/newlogo.png" >
      BitWorking
    </a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Flash Memory for the Blackfin DSP</h1>
    <p class="post-meta">
      <a class="u-url" href="/news/2004/04/Flash_Memory_for_the_Blackfin_DSP">
        <time datetime="2004-04-19T00:00:00-04:00" itemprop="datePublished" class="dt-published">
          
          Apr 19, 2004
        </time>
      </a>
      â€¢ <a rel="author me" class="p-author h-card" href="/about"> <span itemprop="author"
          itemscope itemtype="http://schema.org/Person">
          <img class="u-photo" src="/images/joe2016.jpg" alt="" style="height: 16px; border-radius: 8px; margin-right: 4px;" />
          <span
            itemprop="name">Joe Gregorio</span></span></a>
      </p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
      <p>You've seen all the warnings when upgrading the firmware 
  on some card, be it your PCMCIA Wi-Fi card, or maybe your
  MP3 player.</p>
<blockquote>
<p>Interrupting a firmware update in progress 
     (i.e. during the firmware upload into the SOMEHARDWARE) 
     may render the SOMEHARDWARE inoperative.</p>
<p>If the firmware upload fails, and subsequent 
     upload attempts prove unsuccessful, the unit may need 
     to be returned to THE COMPANY for service.</p>
</blockquote>
<p>I've anonymized the above statement to save singling out a particular
   company, but I have seen this on a wide range of devices. So what's
   going on here, why are these devices so fragile?</p>
<p>Here's the basic layout of an embedded system, stripped to just
   the basics we want to talk about.</p>

  
<p><embed src="http://bitworking.org/images/SimpleCpuToFlashWithBevel.svg" width="300px" height="200px" type="image/svg+xml"></embed></p>
<p>The Flash is where the program is stored that the CPU runs. Now it 
  could be either run straight out of Flash, or loaded into RAM before
  being run. How it's actually used is irrelevant right now. The big problem
  is how that program gets in there in the first place, and how it
  gets updated. This tends to be an area that gets overlooked.</p>
<p>How it gets updated is rather fragile, and an incomplete
   load could end up disabling your firmware. This is actually 
   a rather abysmal situation and can in most cases be completely
   avoided.</p>
<p>Updating the code is usually a matter of piping a new program image
   through the running CPU into the Flash memory. This
   is where the problems start. If the CPU runs off the code
   in Flash, and the CPU is writing new code to the Flash, how
   do you avoid disaster? It's like changing your from your
   shoes into your boots without letting your sock convered foot
   touch the ground. It's possible, but it requires balance. The 
   same is true with the memory, you can run code, and you can write
   new code into the Flash, just not at the same spot as the same time.
</p>
<p>One strategy is to have a nugget of code that runs in one
   protected section of memory that can handle uploading new code.
    That way if a firmware upload fails, this 
   loading code will remain in place and a new upload can be 
   attempted, thus saving your device from becoming a useless hunk
   of inert electronics.
   Many Flash devices support this kind of strategy, offering 
   memories that have a lockable region usually at the bottom 
   of memory that can be written with loading code and then locked to
   prevent it from being overwritten accidently.</p>
<p>But that is only how to upgrade the firmware. How does it
  get there in the first place? Now if you are a volume manufacturer,
  churning out thousands of said devices than the answer is simple, 
  you order your Flash from the manufacturer or reseller with your 
  firmware image already preloaded. If, on the other hand, you are a
  shop that does smaller runs than you need alternative loading mechanisms.
</p>
<p>One of the best I have seen is this line of memory chips from ST Microelectronics
   called PSDs or <a href="http://www.st.com/stonline/products/families/memories/psm/index.htm">
   Programmable System Devices</a>. These chips can incorporate Flash, SRAM,
   Digital I/Os, a small PLD area, and most importantly for our discussion a JTAG
   interface. The memory itself has a JTAG interface that you use to program
   the Flash memory independent of the CPU. In particular they have the 
   <a href="http://www.st.com/stonline/products/families/memories/psm/dsm2150.htm">
   DSM2150F5</a> which is a 
   <a href="http://www.st.com/stonline/products/families/memories/psm/dsm_ov1.htm">
     DSP System Memory</a> (DSM) which contains Flash, Digital I/O, and a PLD and was
   designed specifically with the Analog Devices Blackfin DSP in mind.</p>
<p>  These devices solve the initial program load dilemma along with
  providing a host of other abilities. In particular DSPs are notorious
  for not providing enough digital I/O, and placing it on the Flash memory
  where it can be accessed via memory mapped regions is great. It will
  be interesting to see what other vendors come up with in the area 
  of programmable system devices.

</p>
  
  

  </div>

  <script type="text/javascript" charset="utf-8">
    fetch('/u/mentions').then(function(resp) {
      if (!resp.ok) {
        return
      }
      resp.text().then(function(text) {
        document.getElementById('mentions').innerHTML = text;
      });
    });
  </script>
  <div id=mentions>
  </div>

  
    

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://bitworking.org/news/2004/04/Flash_Memory_for_the_Blackfin_DSP';
      this.page.identifier = 'https://bitworking.org/news/2004/04/Flash_Memory_for_the_Blackfin_DSP';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://bitworking-1.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    
    <div class="PageNavigation">
      
      <a class="prev" href="/news/2004/04/A_New_Patio">&laquo;
        A New Patio</a>
      
      
      <a class="next"
        href="/news/2004/04/26Apr2004">Protocol Design Papers &raquo;</a>
      
    </div>
    

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              BitWorking
            
            </li>
            
            <li><a rel=me class="u-email" href="mailto:joe@bitworking.org">joe@bitworking.org</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jcgregorio" rel=me><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">jcgregorio</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/bitworking" rel=me><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">bitworking</span></a>

          </li>
          

          <li>
            <a href="https://plus.google.com/+JoeGregorio" rel=me>
              <svg enable-background="new 0 0 128 128" height="16px" viewBox="0 0 128 128" width="16px" xml:space="preserve">
                <circle cx="64" cy="64" fill="gray" r="64"/>
                <path d="M49.424,97.875c-19.018,0-34.491-15.193-34.491-33.874c0-18.68,15.473-33.875,34.491-33.875 c8.318,0,16.354,2.952,22.624,8.309l-8.771,9.899c-3.838-3.279-8.758-5.086-13.853-5.086c-11.652,0-21.13,9.31-21.13,20.752 c0,11.441,9.479,20.75,21.13,20.75c9.858,0,16.311-4.723,18.407-13.197H49.587V58.432h32.347v6.562 C81.934,84.659,68.869,97.875,49.424,97.875z"
                fill="#FFFFFF"/>
                <polygon fill="#FFFFFF" points="117.934,58.438
                107.934,58.438 107.934,48.438 99.934,48.438 99.934,58.438
                89.934,58.438     89.934,66.438 99.934,66.438 99.934,76.438
                107.934,76.438 107.934,66.438 117.934,66.438   "/>
              </svg>
              <span class="username">JoeGregorio</span></a>
          </li>
        </ul>
      </div>

      <div class="h-card footer-col footer-col-3">
        <p class="p-note">Joe Gregorio - REST, Web, Python, Go, APIs, Dad, Husband, Maker, or any linear combination of such. Googler.
</p>
        <a class="p-name u-url" href="https://bitworking.org" style="display: none"><img
          class="u-photo" src="/images/joe2016.jpg" alt="" />Joe Gregorio</a>
        <a rel=me class="u-email" href="mailto:joe@bitworking.org">joe@bitworking.org</a>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
