---
title: How To Do RESTful Partial Updates
date: 2008-02-14T12:00:00-05:00
---

  
  <p><b>Update 1:</b> Wow, apparently using Atom as an example was a bad idea given the number of people  with their <a href="http://intertwingly.net/blog/2008/02/15/Embrace-Extend-then-Innovate">knickers</a> <a href="http://www.snellspace.com/wp/?p=889">in a twist</a>. </p> <p><b>Update 2:</b> Fixed the URI Template to accomodate    <a href="http://intertwingly.net/blog/2008/02/15/Embrace-Extend-then-Innovate">Sam's nose</a>. </p> <p><b>Update 3:</b> Good feedback from <a href="http://www.tbray.org/ongoing/When/200x/2008/02/16/HTTP-Sweet-Spot">Tim Bray</a>, <a href="http://www.mnot.net/blog/2008/02/17/post_patch">Mark Nottingham</a>, and <a href="http://blog.mozilla.com/rob-sayre/2008/02/15/restful-partial-updates/">Rob Sayre</a>. </p> <p>There are times when you have a large representation of a resource and only want to edit a small part of that resource. Wikipedia is a good example, where many entries in the encyclopedia are very long and you don't want to wade through all that wiki markup to correct a typo in one sub-section. To make it easier MediaWiki offers an edit link on each sub-section that allows you to edit just that sub-section. This same problem comes up in many other contexts, for example, editing a large Atom Entry via AtomPub, or working over a slow connections, ala a mobile device.</p><img class="unframed" src="http://bitworking.org/images/2008/02/mediawiki-edit.jpg" style="margin: 1em;" /> <p>Just like the MediaWiki example, this can be done RESTfully and we'll construct just such a mechanism for AtomPub, and it should be obvious by the time we're done on how you can also do this for JSON. </p> <p>So here's the goal: to be able to update and/or delete multiple sub-sections of a resource with a single request. </p> <p>Starting from the MediaWiki example the easiest thing to do is define a URI for each sub-section we want to be updated. That gets us most of the way there, but only allows one sub-section to be updated at a time, and doesn't allow more than one sub-section to be updated in the same request.Â  So instead of having a single URI for each sub-section, we'll construct a URI that represents the set of sub-sections we want to update. And how shall we construct a URI? With <a href="http://bitworking.org/projects/URI-Templates">URI Templates</a> of course.</p> <p>Here's a concrete example, an Atom Entry from an AtomPub Collection that lives at the URI <code>http://example.org/edit/first-post.atom</code> and has the following representation:</p><pre><code>&lt;?xml version="1.0"?&gt;
&lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
    &lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
    &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
    &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
    &lt;author&gt;&lt;name&gt;John Doe&lt;/name&gt;&lt;/author&gt;
    &lt;content&gt;Some text.&lt;/content&gt;
    &lt;link rel="edit"
        href="http://example.org/edit/first-post.atom"/&gt;
&lt;/entry&gt;</code></pre>
<p>Now if I wanted to update part of this entry, say the title, using the mechanisms in <a href="http://www.ietf.org/rfc/rfc5023.txt">RFC 5023</a> then I would change the value of the title element and PUT the whole modified entry back to the the URI <code>http://example.org/edit/first-post.atom</code>. Now this document isn't large, but we'll use it to demonstrate the concepts. The first thing we want to do is add a URI Template that allows us to construct a URI to PUT changes back to:</p><pre><code>&lt;?xml version="1.0"?&gt;
&lt;entry         
        xmlns="http://www.w3.org/2005/Atom"
        <b><i>xmlns:t="http://blah..."&gt;</i></b>
<b><i>&lt;t:link_template ref="sub" 
        href="http://example.org/edit/first-post/{-listjoin|;|id}"/&gt;</i></b>
    &lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
    &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
    &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
    &lt;author&gt;&lt;name&gt;John Doe&lt;/name&gt;&lt;/author&gt;
    &lt;content&gt;Some text.&lt;/content&gt;
    &lt;link rel="edit"
        href="http://example.org/edit/first-post.atom"/&gt;
&lt;/entry&gt;</code></pre>
<p>Then we need to add id's to each of the pieces of the document we wish to be able to individually update. For this we'll use the W3C xml:id specification:</p><pre><code>&lt;?xml version="1.0"?&gt;
&lt;entry         
        xmlns="http://www.w3.org/2005/Atom"
        xmlns:t="http://blah..."&gt;   
    &lt;t:link_template ref="sub" href="http://example.org/edit/first-post/{-listjoin|;|id}"/&gt;
    &lt;title <b><u>xml:id="X1"</u></b>&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
    &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
    &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
    &lt;author <b><u>xml:id="X2"</u></b>&gt;&lt;name&gt;John Doe&lt;/name&gt;&lt;/author&gt;
    &lt;content <b><u>xml:id="X3"</u></b>&gt;Some text.&lt;/content&gt;
    &lt;link rel="edit"
        href="http://example.org/edit/first-post.atom"/&gt;
&lt;/entry&gt;</code></pre>
<p> </p>
<p>So if I wanted to update both the content and the title I would construct the partial update URI using the id's of the elements I want to update:</p>
<p> <strong><u>http://example.org/edit/first-post/X1;X3<br /></u></strong></p>
<p>And then I would PUT an entry to the URI with only those child elements:</p><pre><code>PUT /edit/first-post/X1;X3
Host: example.org

&lt;?xml version="1.0"?&gt;
&lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
   &lt;title xml:id="X1"&gt;False alarm on the Atom-Powered Robots things&lt;/title&gt;
   &lt;content xml:id="X3"&gt;Sorry about that.&lt;/content&gt;
&lt;/entry&gt;</code></pre>
<p> </p>
<p>Notes:</p>
<ol>
<li>We keep the entry document element, ensuring that this it at least a well-formed XML document, but probably not a valid Atom Entry. 
</li><li>Absence of an element whose id is present in the partial update URI means that it is to be deleted. 
</li><li>You could also do a GET on the partial update URI to retrieve the current state of the sub-sections it identifies. 
</li><li>If no t:link_template/@rel="partial_upate" is found then the server doesn't support partial updates and you drop back to doing a simple PUT of the entire representation as defined in AtomPub. 
</li><li>This puts the server firmly in control of what sub-sections of a document it is willing to handle partial updates on. 
</li><li>The use of URI templates also puts the server firmly in control of the shape of the URI used for partial updates. 
</li><li>I didn't use a link element for the URI Template since URI Templates are not URIs. They become valid URIs after they're filled in, but the presence of the '{' and '}' characters means that they aren't valid URIs themselves. 
</li><li>This doesn't solve all the partial update scenarios, for example this doesn't help if you have a long sub-list that you want to append to. 
</li><li>You'll notice that I didn't give a good URI for the 't' namespace. I know better, if I did there'd be an implementation of this by the end of the day. One of the reasons I don't want to see that happen is that there are some open questions that need to be answered first:</li></ol>
<p>Open Issues:</p>
<ol>
<li>Do you have to include the xml:id attributes when you PUT back an update? 
</li><li>Do the xml:id attributes appear when you do a GET on such a resource? 
</li><li>Obviously the representation of a partial update resource is not a valid Atom Entry. What should be the mime-type of that resource? 
</li><li>There are undoubtedly XML parsers that will choke on xml:id attributes even though according to the XML specification the 'xml' qname is reserved and should always be defined. Are these problems widespread enough to kill the use of xml:id and warrant the creation of an id attribute in another namespace? 
</li><li>Can t:link_template elements use the same IANA Atom Link Relation Registry or do they need their own registry, or do we just hold our noses and put the URI Template in an atom:link element? Obviously the set of t;link_template relations is a super-set of atom:link relations. The same problem also exists for using URI Templates in HTML link elements. 
</li><li>How do you handle descendents that aren't children of the document element? </li></ol>
<p>That last open question needs a little more explanation. If we had the id on <code>name</code> instead of <code>author</code>:</p>
<p></p><pre><code>&lt;?xml version="1.0"?&gt;
&lt;entry         
        xmlns="http://www.w3.org/2005/Atom"
        xmlns:t="http://blah..."&gt;   
    &lt;t:link_template rel="sub" href="http://example.org/edit/first-post/{-listjoin|;|id}"/&gt;
    &lt;title xml:id="X1"&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
    &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
    &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
    &lt;author&gt;&lt;name <b><u>xml:id="X2"</u></b>&gt;John Doe&lt;/name&gt;&lt;/author&gt;
    &lt;content xml:id="X3"&gt;Some text.&lt;/content&gt;
    &lt;link rel="edit"
        href="http://example.org/edit/first-post.atom"/&gt;
&lt;/entry&gt;</code></pre>
<p>Then what does an update look like? Notice that name is a descendent of entry, but not a child. Do we include the <code>author</code> element on the update? That is, do we send: </p><pre><code>PUT /edit/first-post/X2
Host: example.org

&lt;?xml version="1.0"?&gt;
&lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
    &lt;name <b><u>xml:id="X2"</u></b>&gt;John Doe&lt;/name&gt;
&lt;/entry&gt;</code></pre>
<p>or do we send:</p><pre><code>PUT /edit/first-post/X2
Host: example.org

&lt;?xml version="1.0"?&gt;
&lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
    &lt;author&gt;&lt;name <b><u>xml:id="X2"</u></b>&gt;John Doe&lt;/name&gt;&lt;/author&gt;
&lt;/entry&gt;</code></pre>
<p>So there you have it, outside of six open questions, a nice RESTful way to do partial updates.</p>
  <div class="commentContent" id="X1">
    7. What happens when one of the updates succeeds but another fails?

I'd be interested in the actual use-case.
    <p class="commentByLine">Posted by
       <a href="http://www.tbray.org/ongoing/">Tim Bray</a> on <a href="#X1" title="2008-02-15T00:22:06.078707">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X2">
    Tim,<br />
<p>What happens in straight AtomPub when you PUT a full entry back to the edit URI and part of the update fails?</p>
    <p class="commentByLine">Posted by
       <a href="http://bitworking.org">Joe</a> on <a href="#X2" title="2008-02-15T00:34:25.615362">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X3">
    <blockquote>Q#1: Do you have to include the xml:id attributes when you PUT back an update?</blockquote>
<p>Generally I wouldn't think so, however consider if you are partially updating two or more elements of the same kind (eg. atom:link). It shouldn't matter there either if the xml:id's are not meant to be persistent. However, I can imagine cases where you might want to preserve the xml:id's, such as another extension which ties two elements together via xml:id and (eg) xml:idref, or simply for external references to survive partial updates.</p>
<p>The agent doing the partial update wouldn't necessarily be in the position to know whether other extensions rely on the persistence of xml:id or whether there are external references to those xml:id's, and so shouldn't be tasked with the option.</p>
<p>Thus, to answer <q>Do you have to include the xml:id attributes when you PUT back an update?</q> .. my answer is <i>YES</i>.</p>
<p>On Q#6 .. what happens if your example had the following instead: </p>
<pre><code>&lt;author&gt;
    &lt;name xml:id="X2"&gt;John Doe&lt;/name&gt;
    &lt;name&gt;John Doe&lt;/name&gt;
    &lt;uri&gt;http://example.org/&lt;/uri&gt;
&lt;/author&gt;</code></pre>
<p>then what happens to the atom:uri when we PUT back <code>&lt;author&gt;&lt;name xml:id="X2"&gt;Jane Doe&lt;/name&gt;&lt;/author&gt;</code>? Does the atom:uri get deleted or does it stay? What if we PUT back <code>&lt;author&gt;&lt;name xml:id="X2"&gt;Jane Doe&lt;/name&gt;&lt;uri&gt;http://example.org/different&lt;/uri&gt;
&lt;/author&gt;</code> .. do we also update the author's atom:uri (despite there being no xml:id on it), or do we ignore what was PUT?</p>
<p>I'm leaning towards just sending back a non-hierarchical bag of elements to be updated, using the xml:id's to put them all in the right place. One option that approach disallows though is that you can't move elements around (say swapping the atom:uri of two contributors). Not a problem though: a move is just a shortcut way of deleting and creating.</p>
    <p class="commentByLine">Posted by
       <a href="mailto:eric@ironclad.net.au">eric scheid</a> on <a href="#X3" title="2008-02-15T03:40:34.670823">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X4">
    I doubt many of the readers of this blog have much interest or fondness for the WS-ResourceTransfer specification, but there is plenty of similarity. If anyone cares, I took a quick stab at comparing them:
<a href="http://stage.vambenepe.com/archives/164">http://stage.vambenepe.com/archives/164</a>
    <p class="commentByLine">Posted by
       <a href="http://stage.vambenepe.com/">William Vambenepe</a> on <a href="#X4" title="2008-02-15T03:47:02.013640">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X5">
    <p>@William: interesting notes. The race condition problem you noted has a known solution, being ETags. Joe is probably taking that as assumed in the discussion above since the Atom Publishing Protocol (RFC 5023) uses that solution too.</p>
<p>I've got an addendum to my earlier comment (since the 5 minute timer for updates goes from initial post, not subsequent edit posts)</p>
<p>Eschewing hierarchy also leads to the thought that the document element doesn't have to be atom:entry either, which goes some way towards answering Q#3. Perhaps you could define your own document element (and namespace an mime-type) appropriate for partial updates. Something like <code>&lt;x:update&gt;</code></p>
<p>eek .. someone stop me before I reinvent something ghastly .. you could even have: 
<pre><code>&lt;x:update&gt;
    &lt;x:parts&gt;&lt;!-- as above --&gt;&lt;/x:parts&gt;
    &lt;x:callback&gt;http://example.com/someuri&lt;/x:callback&gt;
    &lt;x:some-other-non-payload-metadata&gt;[...]&lt;/x:some-other-non-payload-metadata&gt;
&lt;/x:update&gt;</code></pre>
</p>
    <p class="commentByLine">Posted by
       <a href="mailto:eric@ironclad.net.au">eric scheid</a> on <a href="#X5" title="2008-02-15T04:08:53.812524">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X6">
    <p>I like the idea in general. However, I am concerned that you're trying to infer the content of the surroundings. Note that this doesn't happen with WikiMedia either; you only see the sub-section you're interested in, not some collection of 'and it's located in ...' elements. In fact, the only time you'd need to view the parent is if you wanted to move it to somewhere else.</p>
<p>What's wrong with using # on the URI? That's a way of navigating straight to a different part e.g. thing.atom#foo. I think if the content type is XML, then using an xml:id is fine; but I don't necessarily think it has to be XML specific.</p>
<p>I think the interesting thing is being able to update two parts of the resource at once; but is that a common case? Why not just be able to use this to update one part of the content (and its children) at a time? If you want to update two different parts, use two requests. If they need to be simultaneous, put the parent instead (or a parent containing both).</p>
<p>In fact, isn't the REST approach to treat the URL of thing.atom#foo as just being a resource? The fact it might be just *part* of a larger resource isn't really relevant, in much the same way that blog/2008/ might be a larger collection of blog/2008/02/ -- but when I'm PUTting an entry, I don't have to surround the blog data with AllBlogsEver/2008Blogs/02Blog/MyBlogEntry to be able handle it.</p>
<p>What you've really exposed is a way of exposing child data of a document as a separate URI. You can use normal REST semantics to update that child URI part on its own, regardless of where it actually is.</p>
    <p class="commentByLine">Posted by
       <a href="http://alblue.blogspot.com">Alex</a> on <a href="#X6" title="2008-02-15T08:40:09.215794">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X7">
    Sorry to be a nitpick but you you made this typo a number of time:

<pre>
&lt;entry xmlns="http://www.w3.org/2005/Atom"
</pre>

Should be:

<pre>
&lt;entry xmlns="http://www.w3.org/2005/Atom"&gt;
</pre>
    <p class="commentByLine">Posted by
       <a href="http://bytesexual.org/">Noah Slater</a> on <a href="#X7" title="2008-02-15T08:58:50.755918">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X8">
    Noah,<br />
<p>Fixed, thanks!</p>
    <p class="commentByLine">Posted by
       <a href="http://bitworking.org">Joe</a> on <a href="#X8" title="2008-02-15T09:55:11.963817">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X9">
    <blockquote>Wow, apparently using Atom as an example was a bad idea given the number of people with their knickers in a twist. </blockquote>

Using Atom as an example was a bad idea because it's a bad solution.  Perhaps you could take some time to actually address the actual issues that were mentioned?
    <p class="commentByLine">Posted by
       <a href="mailto:jasnell@gmail.com">James Snell</a> on <a href="#X9" title="2008-02-15T11:33:30.079995">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X10">
    So, in a multiple-update scenario, if one fails for some reason then they all fail?  OK, sounds like the only sane policy to me.  -Tim
    <p class="commentByLine">Posted by
       <a href="http://www.tbray.org/ongoing/">Tim</a> on <a href="#X10" title="2008-02-15T11:42:56.408872">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X11">
    What you are suggesting is just a way of generating URIs to identify parts of the resources that could be added, deleted or modified. What would a GET to a URI like http://example.org/edit/first-post/X1;X3 return? A partial resource? How about idempotency? It is not clear from your examples, but is this idempotent?
    <p class="commentByLine">Posted by
       <a href="http://www.subbu.org">Subbu Allamaraju</a> on <a href="#X11" title="2008-02-15T14:33:06.935486">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X12">
    (After some more thinking - hope your spam filter won't catch this)

One key problem I see that this model requires encoding a diff format into the URI itself. I would be concerned about extending this model as a "general" RESTful solution for patching resources.
    <p class="commentByLine">Posted by
       <a href="http://www.subbu.org">Subbu Allamaraju</a> on <a href="#X12" title="2008-02-15T15:22:52.599295">2008-02-15</a>
    </p>
</div><div class="commentContent" id="X13">
    Have you considered XCAP (http://ietfreport.isoc.org/idref/rfc4825/) ?
    <p class="commentByLine">Posted by
       <a href="mailto:francois.leygues@alcatel-lucent.fr">francois leygues</a> on <a href="#X13" title="2008-02-16T08:12:00.884758">2008-02-16</a>
    </p>
</div><div class="commentContent" id="X14">
    <p>I started to reply here, but it got a bit long, so I moved my <a href="http://plasmasturm.org/log/493/" title="Continuous partial debate">response over there</a>.</p>
    <p class="commentByLine">Posted by
       <a href="http://plasmasturm.org/">Aristotle Pagaltzis</a> on <a href="#X14" title="2008-02-17T02:56:21.345003">2008-02-17</a>
    </p>
</div><div class="commentContent" id="X15">
    How can you do bulk updates? Example: add a default area code to all phone numbers that don't have one.<br />

Or continuing along that line, would you not want a kind of more expressive update query language similar to SQL?
    <p class="commentByLine">Posted by
       <a href="mailto:karl@waclawek.net">Karl Waclawek</a> on <a href="#X15" title="2008-02-17T12:04:44.661085">2008-02-17</a>
    </p>
</div><div class="commentContent" id="X16">
    You certainly don't need to add XML IDs to the source XML in order to be able to address it, as you can do this with XPath or even byte offsets. Really the problem here is that you're trying to use PUT to perform what Roy wanted to standardise as PATCH - the two are completely distinct and shouldn't be confused. On the other hand you can do this straightforwardly and RESTfully, using the same URL to refer to the resource (no URI templates malarkey), just using POST and some custom MIME type: either application/x-patch or some kind of XML diff format.
    <p class="commentByLine">Posted by
       <a href="mailto:dog@gnu.org">Chris Burdess</a> on <a href="#X16" title="2008-02-18T09:51:12.638785">2008-02-18</a>
    </p>
</div><div class="commentContent" id="X17">
    <p>Why not keep with a single (edit) URI per subresource, and advertise that instead of the xml:id + URI templates (not that I'm against URI templates per se).<br />
Then use something like the BATCH + application/http approach recently proposed by James Snell to send multiple separate PUT's to separate (sub)resources.</p>
<p>It seems like the batch stuff (or something like it) is going to be needed anyway, so why not use that for this case too and keep the subresource-updates themselves as simple as the MediaWiki example? (it might also solve the multiple status problem)</p>
<p>If the parts deserve to be separate resources, then they get their own URI and you use PUT. But it seems a bit far-fetched to me that every combination of parts would need to become a resource in its own right.<br />
If you do not want the parts to be resources themselves: there may be room for PATCH, but some of the proposed diff formats are really blurring the line between sending content (delta encoding of the representation) and sending code. If you're going to say: "execute this javascript/xquery/whatever" instead of sending a new author or title, that seems almost more like RPC than REST. (otoh, it might not be so bad to use a hybrid approach, but you might as well just use POST then)</p>
    <p class="commentByLine">Posted by
       <a href="mailto:steven.vereecken@gmail.com">Steven Vereecken</a> on <a href="#X17" title="2008-02-18T14:09:18.701799">2008-02-18</a>
    </p>
</div><div class="commentContent" id="X18">
    GET /posts/12345?$expand=authors

GET /posts/12345?$partial=title,content
PUT /posts/12345?$partial=title,content

As ADO.NET seems to be adding $expand to AtomPub, I'd follow a similar route with simply a param of Partial.
    <p class="commentByLine">Posted by
       <a href="http://www.fsnm.co.uk">Andy</a> on <a href="#X18" title="2008-02-20T09:09:39.610243">2008-02-20</a>
    </p>
</div>
  

